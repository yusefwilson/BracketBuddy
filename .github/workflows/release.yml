name: Build & Release BracketBuddy EXE

on:
  push:
    branches:
      - release


permissions:
  contents: write   # <-- 👈 THIS LINE gives permission to publish releases

jobs:
  build-and-release:
    runs-on: windows-latest

    steps:
      # 1️⃣ Checkout your repository
      - name: Checkout repo
        uses: actions/checkout@v3

      # 2️⃣ Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      # 3️⃣ Install root dependencies
      - name: Install root dependencies
        run: npm ci

      # 4️⃣ Install React app dependencies
      - name: Install React app dependencies
        run: |
          cd src-react
          npm ci

      # 4️⃣ Build your EXE
      - name: Build EXE
        run: npm run make

      # 5️⃣ Create/update GitHub release and upload EXE
      - name: Publish Release
        uses: ncipollo/release-action@v1
        with:
          tag: latest
          name: Latest Release
          body: Automated release of BracketBuddy
          artifacts: out/make/squirrel.windows/x64/BracketBuddy-Setup.exe
          allowUpdates: true     # ✅ allows overwriting "latest"
          replacesArtifacts: true # ✅ updates the .exe file each time
